<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€£ç·šä¸­...</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 20%; color: #555; background-color: #fafafa; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #06c755; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    #status { font-size: 14px; margin-top: 10px; }
    #error-box { color: red; margin-top: 20px; font-size: 12px; display: none; padding: 20px; word-break: break-all; }
  </style>
</head>
<body>

  <div class="loader"></div>
  <h3>æ­£åœ¨é€²å…¥é ç´„ç³»çµ±...</h3>
  <div id="status">æº–å‚™è¼‰å…¥ LINE å…ƒä»¶...</div>
  <div id="error-box"></div>

  <script>
    // â–¼â–¼â–¼ 1. ä½ çš„ LIFF ID (ä¹‹å‰ç´€éŒ„çš„) â–¼â–¼â–¼
    const MY_LIFF_ID = "2009054335-tUPGk28q";

    // â–¼â–¼â–¼ 2. ä½ çš„ GAS æ­£å¼ç¶²å€ (å·²å¹«ä½ å¡«å…¥å‰›å‰›æä¾›çš„ ID) â–¼â–¼â–¼
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxu_ke2CmB51jhdgOP05yb6mBfqwdAIPUQL_IfHmmXwlzaDH3sModbISVHiHUgZToBeWg/exec"; 

    window.onload = function() {
      loadLiffSDK();
    };

    function loadLiffSDK() {
      document.getElementById('status').innerText = "é©—è­‰èº«åˆ†ä¸­...";
      
      var script = document.createElement('script');
      script.src = "https://static.line-scdn.net/liff/edge/2/sdk.js";
      script.async = true;
      
      script.onload = function() {
        initLiff();
      };
      
      script.onerror = function() {
        showError("ç„¡æ³•é€£ç·šè‡³ LINEï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚");
      };
      
      document.head.appendChild(script);
    }

    async function initLiff() {
      try {
        await liff.init({ liffId: MY_LIFF_ID });

        // å¦‚æœæ²’ç™»å…¥ï¼ŒåŸ·è¡Œç™»å…¥
        if (!liff.isLoggedIn()) {
          document.getElementById('status').innerText = "è«‹å…ˆç™»å…¥ LINE...";
          liff.login();
          return;
        }

        // å–å¾— User ID
        const profile = await liff.getProfile();
        const userId = profile.userId;
        document.getElementById('status').innerText = "é©—è­‰æˆåŠŸï¼æ­£åœ¨è·³è½‰...";

        // è®€å–ç¶²å€åƒæ•¸ (?page=booking æˆ– ?page=profile)
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page') || 'profile';

        // çµ„åˆç›®æ¨™ç¶²å€ï¼šGAS + UserID + é é¢åƒæ•¸
        const targetUrl = `${GAS_URL}?uid=${userId}&page=${page}`;

        // ğŸš€ åŸ·è¡Œè·³è½‰ (é›¢é–‹ GitHubï¼Œé€²å…¥ GAS)
        window.location.replace(targetUrl);

      } catch (err) {
        showError("åˆå§‹åŒ–å¤±æ•—: " + err.message + "\n(è«‹ç¢ºèª LIFF ID è¨­å®šæ­£ç¢º)");
      }
    }

    function showError(msg) {
      document.querySelector('.loader').style.display = 'none';
      document.getElementById('status').style.display = 'none';
      const box = document.getElementById('error-box');
      box.style.display = 'block';
      box.innerText = "ç™¼ç”ŸéŒ¯èª¤ï¼š\n" + msg;
    }
  </script>
</body>
</html>
