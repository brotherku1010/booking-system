<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€£ç·šè¨ºæ–·</title>
  <script src="https://static.line-scdn.net/liff/2.22.1/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; text-align: center; }
    .box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: left; word-break: break-all; }
    h3 { margin-top: 0; color: #333; }
    .label { font-size: 12px; color: #888; margin-bottom: 5px; }
    .val { background: #eee; padding: 10px; border-radius: 5px; font-family: monospace; color: #007bff; font-weight: bold; }
    button { width: 100%; padding: 15px; background: #06c755; color: white; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; }
    button:disabled { background: #ccc; }
  </style>
</head>
<body>

  <h3>ğŸ” èº«åˆ†é©—è­‰è¨ºæ–·</h3>

  <div class="box">
    <div class="label">ç‹€æ…‹ï¼š</div>
    <div id="status" style="color:#d9534f;">æ­£åœ¨åˆå§‹åŒ– LIFF...</div>
  </div>

  <div id="result-area" style="display:none;">
    <div class="box">
      <div class="label">æˆåŠŸå–å¾— User IDï¼š</div>
      <div class="val" id="uid-display">---</div>
    </div>

    <div class="box">
      <div class="label">æº–å‚™è·³è½‰åˆ° GASï¼š</div>
      <div class="val" id="target-url" style="font-size:11px;">---</div>
    </div>
    
    <button id="go-btn" onclick="jump()">ğŸš€ é€²å…¥é ç´„ç³»çµ±</button>
  </div>

  <script>
    // 1. LIFF ID
    const MY_LIFF_ID = "2009054335-tUPGk28q";

    // 2. GAS ç¶²å€ (è«‹ç¢ºèª ID æ­£ç¢º)
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxu_ke2CmB51jhdgOP05yb6mBfqwdAIPUQL_IfHmmXwlzaDH3sModbISVHiHUgZToBeWg/exec"; 

    let finalUrl = "";

    window.onload = async function() {
      try {
        await liff.init({ liffId: MY_LIFF_ID });

        if (!liff.isLoggedIn()) {
          document.getElementById('status').innerText = "å°šæœªç™»å…¥ï¼Œè«‹åœ¨ LINE ä¸­æ‰“é–‹";
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        const userId = profile.userId;

        // é¡¯ç¤ºçµæœ
        document.getElementById('status').innerText = "âœ… é©—è­‰æˆåŠŸï¼";
        document.getElementById('status').style.color = "#06c755";
        document.getElementById('uid-display').innerText = userId;
        
        // çµ„åˆç¶²å€
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page') || 'profile';
        finalUrl = `${GAS_URL}?uid=${userId}&page=${page}`;
        
        document.getElementById('target-url').innerText = finalUrl;
        document.getElementById('result-area').style.display = 'block';

      } catch (err) {
        document.getElementById('status').innerText = "âŒ éŒ¯èª¤: " + err.message;
        alert("LIFF éŒ¯èª¤: " + err.message);
      }
    };

    function jump() {
      if(finalUrl) {
        window.location.href = finalUrl;
      }
    }
  </script>
</body>
</html>
